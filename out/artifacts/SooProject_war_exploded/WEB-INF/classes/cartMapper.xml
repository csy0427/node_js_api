<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cart">
    <insert id="insertCart">
        INSERT INTO tbl_cart(
        cart_id, user_id, product_id, amount
        ) VALUES (
            #{cartId}, #{userId}, #{productId}, #{amount}
        )
    </insert>

    <select id="listCart" resultType="com.spring.Shop.dto.CartVO">
        SELECT
        c.cart_id AS cartId,
        c.user_id AS userId,
        p.product_id As productId,
        m.username AS userName,
        p.product_name AS productName,
        c.amount,
        p.product_price AS productPrice,
        (product_price * amount) money
        FROM
        board_member m, tbl_product p, tbl_cart c
        WHERE m.userid = c.user_id
        AND p.product_id = c.product_id
        AND c.user_id = #{userId}
        ORDER BY
        c.cart_id
    </select>

    <select id="sumMoney" resultType="int">
        SELECT COALESCE(SUM(product_price * amount), 0) money
        FROM
        tbl_cart c, tbl_product p
        WHERE
        c.product_id = p.product_id AND c.user_id = #{userId}
    </select>

    <delete id="deleteCart">
        DELETE FROM tbl_cart WHERE cart_id = #{cartId}
    </delete>

    <select id="countCart" resultType="int">
        SELECT COUNT(*) FROM tbl_cart
        WHERE user_id= #{userId} AND product_id = #{productId}
    </select>

    <update id="updateCart">
        UPDATE tbl_cart SET amount = amount+ #{amount}
        WHERE user_id= #{userId} AND product_id = #{productId}
    </update>

    <update id="modifyCart">
        UPDATE tbl_cart	SET amount = #{amount}
        WHERE user_id= #{userId} AND product_id = #{productId}
    </update>

</mapper>
